<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ryska Intressen & Nätverk</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  
  <style>
    /* --- LAYOUT & BAS --- */
    body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f6f8; margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    header { background: #fff; border-bottom: 1px solid #ddd; padding: 0 20px; height: 50px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 3px rgba(0,0,0,0.05); z-index: 20; }
    h1 { margin: 0; font-size: 18px; color: #2c3e50; font-weight: 600; }
    
    .view-btn { padding: 6px 12px; border: 1px solid #ccc; background: #f9f9f9; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500; margin-left: 10px; }
    .view-btn.active { background: #2c3e50; color: #fff; border-color: #2c3e50; }
    .view-btn:hover:not(.active) { background: #eee; }

    #main-container { display: flex; flex: 1; overflow: hidden; height: calc(100vh - 50px); position: relative; }
    
    #left-panel { flex: 2; position: relative; border-right: 1px solid #ddd; min-width: 300px; display: flex; flex-direction: column; }
    
    .view-section { flex: 1; display: none; width: 100%; height: 100%; overflow: hidden; }
    .view-section.active { display: block; }
    
    /* Mindmap Container */
    #tree-container { overflow: auto; padding: 40px; background: #f8f9fa; height: 100%; box-sizing: border-box; cursor: grab; }
    #tree-container:active { cursor: grabbing; }

    /* Map Container */
    #map-container { width: 100%; height: 100%; background: #e5e9ec; position: relative; }

    #foi-panel { flex: 1; display: flex; flex-direction: column; background: #fff; min-width: 350px; max-width: 600px; border-left: 1px solid #ccc; box-shadow: -2px 0 5px rgba(0,0,0,0.05); z-index: 15; }

    .tree-controls { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 5px; border-radius: 4px; border: 1px solid #ddd; z-index: 100; display: flex; gap: 5px; }
    .ctrl-btn { padding: 4px 10px; font-size: 11px; cursor: pointer; background: #fff; border: 1px solid #bbb; border-radius: 3px; color: #333; font-weight: bold; }
    .ctrl-btn:hover { background: #eee; }

    /* --- MAP LEGEND --- */
    .map-legend {
        position: absolute;
        bottom: 30px;
        right: 10px;
        background: white;
        padding: 0;
        border-radius: 4px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
        z-index: 1000;
        font-size: 12px;
        width: 190px;
        overflow: hidden;
    }
    .legend-header {
        background: #f1f1f1;
        padding: 8px 10px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ddd;
    }
    .legend-header:hover { background: #e9e9e9; }
    #legend-content { padding: 10px; background: rgba(255,255,255,0.95); }
    .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
    .legend-item:last-child { margin-bottom: 0; }
    
    /* Dots (FOI) */
    .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    .dot.sni-F { background: #e67e22; }
    .dot.sni-K { background: #8e44ad; }
    .dot.sni-G { background: #27ae60; }
    .dot.sni-M { background: #2980b9; }
    .dot.sni-def { background: #95a5a6; }

    /* Rings (Fastigheter) */
    .ring-red { 
        height: 12px; width: 12px; 
        border: 2px solid #c0392b; 
        border-radius: 50%; 
        display: inline-block; 
        margin-right: 6px; 
        box-sizing: border-box; 
    }

    /* X (Blockerade) */
    .x-mark {
        font-weight: 900;
        color: #e74c3c;
        margin-right: 8px;
        font-size: 14px;
        width: 12px;
        text-align: center;
        display: inline-block;
    }

    /* Custom X Icon for Map */
    .custom-x-icon {
        background: none;
        border: none;
    }
    .x-marker-symbol {
        font-size: 18px;
        font-weight: 900;
        color: #e74c3c;
        text-shadow: 0 0 2px white, 0 0 4px white;
        text-align: center;
        width: 20px;
        height: 20px;
        line-height: 20px;
        display: block;
    }

    /* --- HORISONTELL TRÄD-STRUKTUR --- */
    .tree { display: flex; flex-direction: column; }

    .node { display: flex; align-items: center; margin: 5px 0; }

    .content { 
        display: flex; 
        flex-direction: column;
        background: #fff; 
        border: 1px solid #ccc; 
        padding: 8px 12px; 
        border-radius: 6px; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        position: relative; 
        transition: all 0.2s; 
        min-width: 180px;
        max-width: 320px; 
        z-index: 2;
    }
    .content:hover { border-color: #999; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transform: translateY(-1px); }

    .content::after { content: ''; position: absolute; right: -20px; top: 50%; width: 20px; height: 2px; background: #ccc; z-index: 1; }
    .node.leaf .content::after { display: none; }

    .children { 
        display: flex; 
        flex-direction: column; 
        margin-left: 20px; 
        position: relative;
        border-left: 2px solid #ccc; 
    }
    .children.hidden { display: none; }

    .children .node { position: relative; padding-left: 20px; }
    .children .node::before { content: ''; position: absolute; left: 0; top: 50%; width: 20px; height: 2px; background: #ccc; }

    /* RÖTTER & SPECIAL */
    .node.root > .content { background: #2c3e50; color: #fff; border: none; min-width: 200px; }
    .node.root > .content .info { color: #ddd; }
    .node.root > .content::after { background: #2c3e50; }
    
    .highlight-box { background-color: #fff8e1; border-left: 4px solid #f39c12; }
    .alert-box { background-color: #ffebee; border-left: 4px solid #c62828; }

    .title { font-weight: 600; font-size: 13px; color: #333; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
    .info { display: block; font-size: 11px; color: #666; margin-top: 4px; line-height: 1.3; }
    
    /* Länk-container */
    .links { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
    .link { color: #0066cc; text-decoration: none; font-size: 10px; font-weight: bold; background: #eef6fc; padding: 2px 5px; border-radius: 3px; border: 1px solid #dceefb; }
    .link:hover { text-decoration: none; background: #d0e8fa; border-color: #0066cc; }

    .toggle-icon { font-size: 14px; font-weight: bold; color: #777; margin-left: 8px; width: 16px; text-align: center; }
    .node.leaf .toggle-icon { visibility: hidden; }

    /* --- FOI TABELL STYLING --- */
    .panel-header { padding: 10px 15px; background: #f1f1f1; border-bottom: 1px solid #ddd; }
    .panel-header h2 { margin: 0 0 10px 0; font-size: 14px; color: #555; text-transform: uppercase; letter-spacing: 0.5px; }
    #searchFOI { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    .table-wrapper { flex: 1; overflow-y: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th { position: sticky; top: 0; background: #fff; border-bottom: 2px solid #333; text-align: left; padding: 8px; z-index: 5; font-weight: 700; color: #333; }
    td { padding: 6px 8px; border-bottom: 1px solid #eee; vertical-align: top; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #eef6fc; cursor: pointer; }
    .sni-tag { display: inline-block; padding: 1px 4px; border-radius: 3px; color: white; font-weight: bold; font-size: 10px; min-width: 15px; text-align: center; }
    .sni-F { background: #e67e22; } .sni-G { background: #27ae60; } .sni-K { background: #8e44ad; } .sni-M { background: #2980b9; } .sni-def { background: #95a5a6; }

    @media (max-width: 768px) {
      #main-container { flex-direction: column; overflow-y: auto; }
      #left-panel, #foi-panel { flex: none; width: 100%; min-width: 0; }
      #left-panel { height: 60vh; }
      #foi-panel { height: 40vh; border-left: none; border-top: 2px solid #333; }
      .tree { margin-left: 0; }
      body { overflow: auto; }
    }
  </style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center;">
    <h1>Ryska Intressen & Nätverk</h1>
    <div style="margin-left:20px;">
        <button class="view-btn active" onclick="setView('tree')">Mindmap</button>
        <button class="view-btn" onclick="setView('map')">Karta</button>
    </div>
  </div>
  <div style="font-size:12px; color:#666;">Interaktiv analys</div>
</header>

<div id="main-container">
  <div id="left-panel">
    
    <div id="view-tree" class="view-section active">
        <div class="tree-controls">
            <button class="ctrl-btn" onclick="expandAll()">[+] Fäll ut allt</button>
            <button class="ctrl-btn" onclick="collapseAll()">[-] Fäll ihop allt</button>
        </div>
        <div id="tree-container">
            <div id="tree-root" class="tree"></div>
        </div>
    </div>

    <div id="view-map" class="view-section">
        <div id="map-container">
            <div id="map-legend" class="map-legend">
                <div class="legend-header" onclick="toggleLegend()">
                    <span>Teckenförklaring</span>
                    <span id="legend-icon">−</span>
                </div>
                <div id="legend-content">
                    <div class="legend-item"><span class="ring-red"></span> Köpta/Strategiska Fastigheter</div>
                    <div class="legend-item"><span class="x-mark">X</span> Blockerade Köp/Områden</div>
                    <hr style="border:0; border-top:1px solid #eee; margin:5px 0;">
                    <div class="legend-item"><span class="dot sni-F"></span> Bygg & Anläggning (F)</div>
                    <div class="legend-item"><span class="dot sni-K"></span> Finans & Försäkring (K)</div>
                    <div class="legend-item"><span class="dot sni-G"></span> Handel (G)</div>
                    <div class="legend-item"><span class="dot sni-M"></span> Juridik/Teknik/Konsult (M)</div>
                    <div class="legend-item"><span class="dot sni-def"></span> Övrigt / Okänt</div>
                </div>
            </div>
        </div>
    </div>

  </div>

  <div id="foi-panel">
    <div class="panel-header">
      <h2>FOI-register (128 bolag)</h2>
      <input type="text" id="searchFOI" placeholder="Sök bolag, ägare, ort..." onkeyup="filterFOI()">
      <div style="margin-top:5px; font-size:11px; color:#666;" id="foi-count">Visar alla rader</div>
    </div>
    <div class="table-wrapper">
      <table id="foi-table">
        <thead>
          <tr>
            <th width="30">Nr</th>
            <th>Bolag & Säte</th>
            <th width="30">SNI</th>
            <th>Ägare / Info</th>
          </tr>
        </thead>
        <tbody id="foi-body">
          </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
// ==========================================
// 1. DATA: TRÄDSTRUKTUR (ANALYS)
// ==========================================
const treeData = {
  title: "Ryskt Fastighetsägande & Org. Brottslighet",
  info: "Översikt av kopplingar, fastigheter och nätverk i Norden.",
  isRoot: true,
  children: [
    // --- GREN 1: FASTIGHETER ---
    {
      title: "1) Fastigheter & Mark (Norden)",
      children: [
        {
          title: "Sverige",
          children: [
            { 
              title: "FOI: Ryska ekonomiska intressen", 
              info: "Kartläggning av tillgångar, upphandling och handel.", 
              links: [
                { text: "FOI Nyhet", url: "https://www.foi.se/nyheter-och-press/nyheter/2022-12-06-ryska-ekonomiska-intressen-i-sverige-kartlagda.html" },
                { text: "Rapport (PDF)", url: "https://www.foi.se/download/18.7c39ae1c180e070f335281/1654870093271/FOI-2022-481_7.pdf" }
              ] 
            },
            { 
              title: "Säpo & Omfattning", 
              info: "157 ryska medborgare / 247 fastigheter identifierade.", 
              links: [
                { text: "SvD", url: "https://www.svd.se/a/9zqnX9/sapo-vill-kunna-stoppa-fientliga-fastighetskop" },
                { text: "Syre", url: "https://tidningensyre.se/2023/15-januari-2023/sapo-vill-kunna-stoppa-fientliga-fastighetskop/" }
              ]
            },
            // --- CASE: MUSKÖ ---
            { 
              title: "CASE: Muskö (Marinbas)", 
              info: "Stanislav Aleshchenko, rysk affärsman, äger sjötomt vid inloppet till topphemlig bas.", 
              highlight: true,
              children: [
                {
                    title: "Skattekravet (220 Mkr)",
                    info: "Upptaxerad 2016. Betalade 224 Mkr för att häva beslag av hus, Porsche & Rolex. Driver process i förvaltningsrätten.",
                    links: [
                        { text: "Expressen (2023)", url: "https://www.expressen.se/nyheter/rysk-affarsman-kraver-tillbaka-220-miljoner-med-bilder-pa-slaktat-djur/" }
                    ]
                },
                {
                    title: "Bevisning: Slakt & Vapen",
                    info: "Aleshchenko skickade bilder på slaktat djur, vapenlicenser och gymkort i Moskva för att bevisa att han bor i Ryssland, ej Sverige."
                },
                {
                    title: "Kopplingar: Rosatom",
                    info: "Hans bolag 'Spetsenergoproekt' har kontrakt med ryska kärnvapenkomplexet (Rosatom). Säljer även till fängelser.",
                    alert: true
                },
                {
                    title: "Myndigheters syn",
                    info: "Säkerhetshot. Huset används som säkerhet av Skatteverket. Hustru och son skrivna på Östermalm."
                }
              ]
            },
            // --- CASE: RYSKA HUSET LIDINGÖ (NYTT) ---
            { 
              title: "CASE: 'Ryska huset' (Lidingö)", 
              info: "Kostervägen 5. Utpekad central för rysk underrättelse (GRU/SVR) och föremål för rättstvist.", 
              highlight: true,
              children: [
                {
                    title: "Underrättelseverksamhet",
                    info: "SVT har dokumenterat hur kända underrättelseofficerare regelbundet besökt huset. Nav för GRU/SVR.",
                    links: [
                        { text: "SVT Avslöjande (2023)", url: "https://www.svt.se/nyheter/inrikes/filmerna-avslojar-misstankta-spionernas-besok-i-ryska-huset-pa-lidingo" },
                        { text: "Omni", url: "https://omni.se/spioner-uppges-besoka-ryska-huset-pa-lidingo/a/15XJ2Q" }
                    ]
                },
                {
                    title: "Strategiskt läge",
                    info: "Ligger mellan Bromma (9 km) och Arlanda (35 km). Snabb tillgång till flygnoder."
                },
                {
                    title: "Rättslig tvist",
                    info: "Ryssland krävs på 16 miljoner kr för utebliven hyra/användning.",
                    links: [
                        { text: "SVT (2024)", url: "https://www.svt.se/nyheter/inrikes/ryssland-kravs-pa-16-miljoner-for-omtvistat-hus-pa-lidingo" }
                    ]
                }
              ]
            },
            // --- CASE: SKÄRGÅRDEN & KVICKSUND ---
            { 
              title: "CASE: Skärgårdstomter & Kvicksund", 
              info: "Ryskt nätverk köper tomter i strategiska inlopp och vid broar.", 
              children: [
                  {
                      title: "Kvicksundsbron",
                      info: "Tomt nära bron har kopplats till samma nätverk som den ryska kyrkan i Västerås.",
                      highlight: true,
                      links: [
                          { text: "Liberalerna (2025)", url: "https://vasteras.liberalerna.se/blog/stoppa-ryska-fastighetskop-vasteras-och-sverige-ar-inte-till-salu/" },
                          { text: "Aftonbladet", url: "https://tv.aftonbladet.se/video/381620/ryska-naetverk-koeper-tomter-i-sverige" }
                      ]
                  },
                  {
                      title: "Furusund & Vettershaga",
                      info: "Norra inloppet till skärgården (Roslagen). Kopplingar till underrättelsetjänst.",
                      links: [
                          { text: "Aftonbladet (2025)", url: "https://www.aftonbladet.se/nyheter/a/qPEzvw/ryskt-natverk-koper-tomter-i-stockholms-skargard" },
                          { text: "Allt om Norrtälje", url: "https://alltomnorrtalje.se/uppgifter-ryskt-natverk-ager-mark-i-norrtalje-kommun-kopplingar-till-underrattelsetjansten/" }
                      ]
                  }
              ]
            },
            // --- CASE: VIDJA ---
            { 
              title: "CASE: Vidja / Rymdanläggning", 
              info: "Från fastighetsköp nära Swedish Space Corp till adressbank och ambassadkopplingar.", 
              highlight: true,
              children: [
                {
                  title: "1. Fastighetsköpet",
                  info: "Rysk medborgare köper fastighet nära statlig rymdanläggning under falsk identitet.",
                  links: [
                    { text: "Hem & Hyra (2025a)", url: "https://www.hemhyra.se/reportage/huskop-vid-rymdanlaggning-kopplas-till-penningtvatt-och-ryska-intressen-anmarkningsvart/" }
                  ]
                },
                {
                  title: "2. Adressbank & Skenskrivning",
                  info: "Fastigheten blir 'adressbank'. Hundratals skrivna där (utan att bo).",
                  links: [
                    { text: "Hem & Hyra (2025b)", url: "https://www.hemhyra.se/reportage/sommarstugor-utnyttjas-for-skenskrivning-adresserna-centrala-i-brottsplanen/" }
                  ]
                },
                {
                  title: "3. Kopplingar: Ambassaden",
                  info: "Huvudmän har besökt ambassaden, disponerat fordon och fakturerat ambassaden.",
                  alert: true
                },
                {
                  title: "4. Rättslig status",
                  info: "Gripanden misstänkta för grov penningtvätt. Systemfel i folkbokföringen.",
                  links: [
                    { text: "Hem & Hyra (2025c)", url: "https://www.hemhyra.se/nyheter/polisen-stoppade-hemliga-adressforsaljaren-fick-kora-vidare/" }
                  ]
                }
              ] 
            },
            // --- CASE: KYRKOR & PÅVERKAN ---
            { 
              title: "CASE: Kyrkor som plattformar", 
              info: "Rysk-ortodoxa kyrkan pekas ut som säkerhetshot av Säpo och experter.", 
              children: [
                {
                    title: "Ryska Kyrkan Västerås", 
                    info: "Strategisk placering nära flygplats (Hässlö). Hot om tvångsövertagande (2025).", 
                    links: [
                        { text: "Aftonbladet", url: "https://www.aftonbladet.se/nyheter/a/9358Vp/ryska-kyrkan-i-vasteras-kommunen-forsoker-tvangsoverta-lokalerna" },
                        { text: "Politico (USA)", url: "https://marcusoscarsson.se/just-nu-svensk-byggnad-pekas-ut-i-usa-hotar-sveriges-sakerhet/" }
                    ]
                },
                {
                    title: "S:t Sigfrids Kyrka (Aspudden)", 
                    info: "Kuppartat övertagandeförsök av rysk församling. Säkerhetsexpert varnar för kopplingar till Kreml.", 
                    highlight: true,
                    links: [
                        { text: "Kyrkans Tidning (2025)", url: "https://www.kyrkanstidning.se/nyhet/sakerhetsexpert-varnar-ryssland-kan-anvanda-svenska-kyrkor/147849" }
                    ]
                }
              ]
            }
          ]
        },
        // --- GREN: Baltikum & Europa ---
        {
          title: "Baltikum & Europa (Säkerhet)",
          children: [
            {
              title: "Baltikum: Elsystemet (2025)",
              info: "Baltikum kapade ryska elnätet feb 2025. Svenska kabeln NordBalt avgörande för stabiliteten.",
              links: [
                { text: "Svenska Kraftnät", url: "https://via.tt.se/pressmeddelande/3782539/svenska-sjokabeln-nordbalt-stottar-nar-baltikum-lamnar-det-ryska-elsystemet?publisherId=3235391&lang=sv" }
              ]
            },
            {
              title: "Lettland: Förbud & Statistik",
              info: "Totalförbud mot ryska köp. 38 fall identifierade i början av 2025 innan förbudet.",
              links: [
                { text: "LSM.lv", url: "https://eng.lsm.lv/article/politics/saeima/11.02.2025-real-estate-purchase-ban-for-russians-belarusians-being-considered-in-latvia.a587351/" }
              ]
            },
            {
              title: "Estland: Strategiska objekt",
              info: "Stopp för tredjelandsmedborgare att köpa mark nära kritisk infrastruktur och gräns.",
              links: [
                { text: "ERR News", url: "https://news.err.ee/1609364830/estonia-to-stop-third-country-nationals-from-buying-land-near-strategic-facilities" }
              ]
            },
            {
              title: "Finland: Blockerade köp",
              info: "Försvarsministeriet blockerar ryska affärer (t.ex. Sysmä, Ruokolahti) pga nationell säkerhet.",
              links: [
                { text: "Yle", url: "https://yle.fi/a/74-20130918" }
              ]
            }
          ]
        },
        {
          title: "Finland (Övrigt)",
          children: [
            { title: "Tillståndskrav", info: "Krav på tillstånd för köpare utanför EU/EES.", links: [{ text: "DefMin", url: "https://defmin.fi/en/licences-and-services/authorisation-to-non-eu-and-non-eea-buyers-to-buy-real-estate" }] },
            { 
              title: "CASE: Airiston Helmi & Beslag", 
              info: "Tillslag 2018 (Pargas). Nya beslag 2025 av ryska statliga fastigheter i Helsingfors och Åland (Naftogaz-målet).", 
              links: [{ text: "Ålands Radio", url: "https://alandsradio.ax/nyheter/yle-beslutet-att-beslagta-ryskagda-fastigheter-star-fast-trots-ryska-protester-ror-aven-fastigheter-pa-aland" }] 
            }
          ]
        },
        {
          title: "Norge & Arktis",
          children: [
            { 
              title: "Svalbard (Strategisk Press)", 
              info: "Ryssland utmanar norsk suveränitet. Revitalisering av Pyramiden och Barentsburg som maktmedel.", 
              links: [{ text: "ArcticToday", url: "https://www.arctictoday.com/we-need-to-talk-about-russias-new-tactics-on-svalbard-commentary/" }] 
            },
            { 
              title: "Kirkenes & Gränsen", 
              info: "Hybridhot och ökad spänning vid gränsen. Möten om arktisk säkerhet (2025).", 
              links: [{ text: "High North News", url: "https://www.highnorthnews.com/en/arctic-military-leaders-met-near-norway-russia-border-discussed-hybrid-threats" }] 
            },
            { 
              title: "CASE: 'Russerhytter' (Bardufoss)", 
              info: "Stugor nära militär flygbas. Politikerkona ägare.", 
              links: [{ text: "Forsvarets Forum", url: "https://www.forsvaretsforum.no/bardufoss-bardufoss-flystasjon-russland/politikerkone-har-overtatt-russerhytte-i-bardufoss/372880" }] 
            }
          ]
        },
        {
          title: "Danmark (Spioncentraler)",
          children: [
            { 
              title: "Handelsrepresentationen (Hellerup)", 
              info: "Ryska statens fastighet på Vestagervej. Utpekad av PET som spioncentral. 15 'diplomater' utvisades 2022.", 
              highlight: true,
              links: [
                { text: "DR Nyheder", url: "https://www.dr.dk/nyheder/indland/russisk-spionrede-i-hellerup-bliver-ved-med-vaere-udgangspunkt-spionage" },
                { text: "TV2", url: "https://nyheder.tv2.dk/krimi/2022-04-05-her-holder-de-russiske-spioner-til" }
              ] 
            },
            { 
              title: "Ruslands Hus (Köpenhamn)", 
              info: "Ryskt kulturcenter (Rossotrudnichestvo). Sprider propaganda. Konkurs/Frysta tillgångar 2024.", 
              links: [
                { text: "Berlingske", url: "https://www.berlingske.dk/samfund/ruslands-hus-i-koebenhavn-er-beggaeret-konkurs" }
              ] 
            },
            { 
              title: "Alexander Nevsky Kirke", 
              info: "Rysk-ortodox kyrka på Bredgade. Historisk koppling till tsar-familjen, samlingspunkt för 'Russkiy Mir'.", 
              links: [
                { text: "Kristeligt Dagblad", url: "https://www.kristeligt-dagblad.dk/danmark/russisk-kirke-i-koebenhavn-vi-beder-fred" }
              ] 
            }
          ]
        }
      ]
    },
    // --- GREN 2: BROTTSLIGHET ---
    {
      title: "2) Domar & Org. Brottslighet",
      children: [
        {
          title: "Sverige: Byggsektorn",
          children: [
            { 
              title: "Grov Näringspenningtvätt (Bygg) Södertörns tingsrätt (B 16726-24)", 
              info: "EBM-tillslag och åtal gällande halv miljard kr. Omfattande härva med ryska kopplingar.",
              highlight: true, 
              links: [
                { text: "EBM Tillslag", url: "https://www.ekobrottsmyndigheten.se/naringspenningtvatt-for-nara-en-halv-miljard-kronor-atta-personer-greps-vid-stort-tillslag/" },
                { text: "EBM Åtal", url: "https://www.ekobrottsmyndigheten.se/fem-atalade-for-grov-naringspenningtvatt/" }
              ],
              children: [
                {
                  title: "Struktur & Kopplingar",
                  info: "Klicka för att se detaljerad analys av målet.",
                  children: [
                    {
                      title: "1. Övergripande händelseförlopp",
                      children: [
                        { title: "Systematik", info: "Långvarig struktur verksam sedan minst 2021." },
                        { title: "Aktörer", info: "Ryssland, Belarus, Ukraina, Baltikum." },
                        { title: "Rubricering", info: "Grovt brott p.g.a. professionellt genomförande." }
                      ]
                    },
                    {
                      title: "2. Agerande i praktiken",
                      children: [
                        { title: "Fasadbolag", info: "Instrument för tvätt, fiktiv bokföring. Syfte: Dölja ursprung." },
                        { title: "Industriell skala", info: "30–36 transaktioner/person. Spritt över tid." },
                        { title: "Rollfördelning", info: "Tydlig hierarki: Huvudmän -> Operativa -> Målvakter." }
                      ]
                    },
                    {
                      title: "3. Koppling till Ryska intressen",
                      children: [
                        { title: "Viktor Soloviev", info: "Rysk medborgare i central kärnfunktion." },
                        { title: "Språklig miljö", info: "Sluten miljö, tolkbehov. Tyder på externt nätverk." },
                        { title: "Sanktioner & Kapitalflykt", info: "Möjliggör kapitalrörelser inom EU. Minskar effekt av sanktioner." }
                      ]
                    },
                    {
                      title: "4. Hybridhot-indikatorer",
                      children: [
                        { title: "Uthållighet", info: "Verksamhet över åratal kräver disciplin/resurser." },
                        { title: "Geografi", info: "Kluster i Bandhagen, Vårby, Farsta (logistik)." },
                        { title: "Centralstyrning", info: "Åklagare kräver hårda restriktioner (bevisförstörelse)." }
                      ]
                    },
                    {
                      title: "5. Slutsats",
                      info: "Internationell finansiell infrastruktur. Objektivt i linje med ryska statliga intressen. Gränsland krim/hybrid."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          title: "Lånade Identiteter (B 16538-22)",
          info: "Södertörns tingsrätt. Modus: 'Importera – etablera – avveckla'.",
          highlight: true,
          children: [
            {
              title: "1. Grundmodell",
              info: "Personer tas in -> Folkbokförs -> Lämnar landet. Identiteten lever kvar som verktyg.",
              children: [
                { title: "Metod", info: "Identiteten separeras från den fysiska personen." }
              ]
            },
            {
              title: "2. Etableringsfas",
              children: [
                { title: "Åtgärder", info: "ID-kort, BankID, Bolagsregistrering på 'målvaktsadresser'." },
                { title: "Tecken", info: "Kort tid mellan ankomst och etablering. Minimal faktisk närvaro." }
              ]
            },
            {
              title: "3. Operativ Användning",
              children: [
                { title: "Funktion", info: "Öppna konton, driva bolag, fakturera. Styrs ofta via BankID från utlandet." },
                { title: "Bevisning", info: "Samma IP-mönster för flera 'olika' individer." }
              ]
            },
            {
              title: "4. Avveckling & 'Lånade' IDn",
              children: [
                { title: "Mönster", info: "Personen utvandrar/slutar deklarera, men bolagen fortsätter omsätta pengar." },
                { title: "Exempel", info: "Alim Pilov (utvandrad 2022) - identitet fortsatt aktiv." }
              ]
            },
            {
              title: "5. Central Styrning",
              children: [
                { title: "Kommunikation", info: "Ryskspråkig styrning via Signal. Ej självständiga företagare." },
                { title: "Koppling Ryssland", info: "Möjliggör kapitalflykt och sanktionsundandragande. Gråzon kriminalitet/hybridhot." }
              ]
            },
            {
              title: "6. Nyckelpersoner (Misstänkta)",
              children: [
                { title: "Huvudman: Alim Pilov", info: "Central samordnare. Kontrollerar flödena." },
                { title: "Identitetsbärare", info: "Stanislav Kääpa, Alexander Kosoruchkin, Tomas Mlodianovski, Julia Turova, m.fl." }
              ]
            }
          ]
        },
        {
          title: "EU / Europa",
          children: [
            { title: "Europol SOCTA 2025", info: "Ryska nätverk driver sabotage och påverkan.", links: [{ text: "Rapport (PDF)", url: "https://www.europol.europa.eu/cms/sites/default/files/documents/EU-SOCTA-2025.pdf" }, { text: "Artikel", url: "https://www.theguardian.com/technology/2025/mar/18/russia-criminal-networks-drive-increase-sabotage-europol" }] }
          ]
        },
        {
          title: "USA: Sanktioner",
          children: [
             { title: "OFAC", info: "Sanktioner mot 'Thieves-in-law' (Tjuvar i lagen).", links: [{ text: "TG1811", url: "https://home.treasury.gov/news/press-releases/tg1811" }] }
          ]
        },
        {
          title: "Spanien & Ryssland",
          children: [
            { title: "Operation Troika", info: "Stort maffiamål, frikännande 2018.", links: [{ text: "Jamestown", url: "https://jamestown.org/trial-decade-spain-declares-war-russian-organized-crime/" }] },
            { title: "Operation Oligarch", info: "Tillslag mot ryska maffian 2017.", links: [{ text: "The Insider", url: "https://theins.ru/en/corruption/149860" }] },
            { title: "Tambovskaya", info: "Vladimir Barsukov/Kumarin (domar).", links: [{ text: "Moscow Times", url: "https://www.themoscowtimes.com/archive/barsukov-handed-14-years-for-fraud" }] }
          ]
        }
      ]
    },
    // --- GREN 3: MOSKVAPATRIARKATET ---
    {
      title: "3) Moskvapatriarkatet",
      children: [
        { title: "Helige Sergij (Sthlm)", info: "Etablerad 1990-tal. Utpekad av Säpo som plattform.", links: [{ text: "Expressen", url: "https://www.expressen.se/nyheter/sverige/efter-sapovarning-ryska-statskyrkan-utan-stod/" }] },
        { title: "Rosatom", info: "Uppgifter om finansiering av Västeråskyrkan.", links: [{ text: "SVT", url: "https://www.svt.se/nyheter/lokalt/vastmanland/ryska-statens-karnkraftsbolag-ska-ha-betalat-for-kyrkobygget-i-vasteras" }] },
        { 
          title: "Kopplade Bolag", 
          children: [
            { 
              title: "NC Nordic Control AB", 
              info: "Bokföringsbrott (2021). Finns på FOI-listan.", 
              links: [
                { text: "Dagen", url: "https://www.dagen.se/nyheter/2021/04/10/rysk-ortodox-prast-domd-for-grovt-bokforingsbrott/" },
                { text: "VLT (2019)", url: "https://www.vlt.se/2019-03-20/prasten-makarenko-tillbakavisar-anklagelserna-vi-samarbetar-sjalvklart-inte-med-brottslingar/" }
              ] 
            },
            { title: "InstrumentElectronics AB", info: "Kopplat till GRU-misstankar.", links: [{ text: "Moscow Times", url: "https://www.themoscowtimes.com/2023/10/26/swedish-court-acquits-alleged-russian-agent-a82894" }] }
          ]
        }
      ]
    },
    // --- GREN 4: PRAVFOND ---
    {
      title: "4) Pravfond (Rysk påverkan)",
      highlight: true,
      alert: true,
      children: [
        {
          title: "Grundläggande fakta",
          children: [
            { title: "Formellt namn", info: "Fonden för stöd och skydd av rättigheterna för landsmän som bor utomlands." },
            { title: "Huvudman", info: "Ryska federationen / Ryska UD." },
            { title: "Faktisk funktion", info: "Verktyg för hybridkrigföring, juridiskt skydd för agenter." }
          ]
        },
        {
          title: "Granskningar 2025 (OCCRP/LRT)",
          children: [
            { 
              title: "Sanktionsflykt (OCCRP)", 
              info: "Fortsatta utbetalningar trots EU-sanktioner. Använder mellanhänder/kontanter.", 
              links: [
                { text: "OCCRP - Spies & Criminals", url: "https://www.occrp.org/en/project/dear-compatriots/russian-foundation-aimed-at-helping-compatriots-abroad-supports-spies-criminals-and-propagandists" },
                { text: "OCCRP - EU Payments", url: "https://www.occrp.org/en/project/dear-compatriots/russian-state-fund-paid-allies-in-the-eu-despite-sanctions" }
              ] 
            },
            { 
              title: "Litauen (LRT)", 
              info: "Läckta filer visar finansiering av jurister och politiska aktörer.", 
              links: [
                { text: "LRT", url: "https://www.lrt.lt/en/news-in-english/19/2570212/leaked-files-reveal-lawyers-politicians-in-lithuania-on-kremlin-s-payroll-investigation" }
              ] 
            }
          ]
        },
        {
          title: "Strategisk roll",
          children: [
            { title: "Syfte", info: "Motverka 'russofobi', mobilisera diaspora." },
            { title: "Nyckelpersoner", info: "Aleksandr Udaltsov (Chef), Vladimir Pozdorovkin (Norden/SVR-agent)." }
          ]
        },
        {
          title: "Finansiering & Juridik",
          children: [
            { title: "Finansiering", info: ">50 miljoner SEK till europeiska nätverk." },
            { title: "Vadim Krasikov", info: "GRU-agent (mord i Berlin). Advokat betald av Pravfond." },
            { title: "Viktor Bout", info: "Vapenhandlare. Fick juridiskt stöd." }
          ]
        },
        {
          title: "Sverige (Rurik)",
          children: [
            { title: "Ryska riksförbundet", info: "Fick ca 1 MSEK. Ordf Lioudmila Siegel spred propaganda." },
            { title: "Konsekvenser", info: "MUCF krävde återbetalning. Rurik upplöstes 2024." }
          ]
        },
        {
          title: "Övriga Norden",
          children: [
            { title: "Finland", info: "Org 'Mosaiikki' fick ca 200 000 EUR." },
            { title: "Danmark", info: "'Velinformeret' (Telegram) fick pengar." }
          ]
        }
      ]
    }
  ]
};

// ==========================================
// 2. DATA: FOI-REGISTER (KOMPLETT 1-128)
// ==========================================
const foiList = [
  {id:1, name:"4finance AB", loc:"Stockholm", sni:"K", info:"Tirona Ltd Vera Boiko"},
  {id:2, name:"4spar Aktiebolag", loc:"Stockholm", sni:"K", info:"Tirona Ltd Vera Boiko"},
  {id:3, name:"Akersberg Development AB", loc:"Stockholm", sni:"M", info:"Mikhail Mantrov"},
  {id:4, name:"Tomten 2:179 AB", loc:"Stockholm", sni:"L", info:"Mikhail Mantrov"},
  {id:5, name:"Amitjugofem AB", loc:"Stockholm", sni:"K", info:"Hydrys Inv. Mikhail Prokhorov"},
  {id:6, name:"AmpTrack Technologies AB", loc:"Örebro", sni:"J", info:"Vladimir Kalinin"},
  {id:7, name:"ATI Europe AB", loc:"Stockholm", sni:"G", info:"Grigory Shiyan"},
  {id:8, name:"ATI Nordic AB", loc:"Stockholm", sni:"G", info:"Grigory Shiyan"},
  {id:9, name:"CMA Small Systems AB", loc:"Stockholm", sni:"J", info:"Grigory Shiyan"},
  {id:10, name:"Highex AB", loc:"Stockholm", sni:"J", info:"Grigory Shiyan"},
  {id:11, name:"Avionero AB", loc:"Malmö", sni:"J", info:"Anton Tyulenev"},
  {id:12, name:"Baltresto AB", loc:"Kungälv", sni:"G", info:"Roman Lushnikov"},
  {id:13, name:"CML Construction Services", loc:"Solna", sni:"M", info:"Oleg Deripaska"},
  {id:14, name:"Coffee Please Home AB", loc:"Norsborg", sni:"G", info:"Aleksey Kavtrev"},
  {id:15, name:"Cool Carriers AB", loc:"Stockholm", sni:"H", info:"Mikhail Ganyushin"},
  {id:16, name:"deriStrat AB", loc:"Stockholm", sni:"J", info:"Alexey Zhigarev"},
  {id:17, name:"Eskaro Group AB", loc:"Göteborg", sni:"M", info:"Igor Chumakov"},
  {id:18, name:"Eskaro Ukraine AB", loc:"Göteborg", sni:"C", info:"Igor Chumakov"},
  {id:19, name:"EVOPIPES RG AB", loc:"Ljungby", sni:"M", info:"Miron Gorilovskiy"},
  {id:20, name:"Fastighetsförv. Värmland", loc:"Kristinehamn", sni:"L", info:"Rais Gayfullin"},
  {id:21, name:"Solanz Skandinavien AB", loc:"Kristinehamn", sni:"L", info:"Rais Gayfullin"},
  {id:22, name:"Kurlanda Gård Aktiebolag", loc:"Kristinehamn", sni:"L", info:"Rais Gayfullin"},
  {id:23, name:"GF Service och Installation", loc:"Kristinehamn", sni:"N", info:"Rais Gayfullin"},
  {id:24, name:"Ellapac 11 AB", loc:"Kristinehamn", sni:"L", info:"Rais Gayfullin"},
  {id:25, name:"Gayfullin Fastigheter AB", loc:"Kristinehamn", sni:"L", info:"Rais Gayfullin"},
  {id:26, name:"Gamersgate AB", loc:"Stockholm", sni:"J", info:"Nikolay Trusov"},
  {id:27, name:"Global Triangle AB", loc:"Bandhagen", sni:"G", info:"Nikolay Belov"},
  {id:28, name:"Hotell Roslagen Nya AB", loc:"Norrtälje", sni:"I", info:"Yury Vasin"},
  {id:29, name:"Evion Hotell & Restaurang", loc:"Göteborg", sni:"I", info:"Yury Vasin"},
  {id:30, name:"InstrumentElectronics AB", loc:"Nacka", sni:"G", info:"Vladimir Kulemekov"},
  {id:31, name:"IST Group AB", loc:"Växjö", sni:"J", info:"Tatiana Sundeby"},
  {id:32, name:"IST Sverige AB", loc:"Växjö", sni:"J", info:"Tatiana Sundeby"},
  {id:33, name:"Ja Rocka Roll Studios AB", loc:"Linköping", sni:"J", info:"Tatiana Sundeby"},
  {id:34, name:"Schoolido AB", loc:"Nacka", sni:"P", info:"Tatiana Sundeby"},
  {id:35, name:"Sigfridshäll i Växjö AB", loc:"Växjö", sni:"L", info:"Tatiana Sundeby"},
  {id:36, name:"Lärandets Hus AB", loc:"Växjö", sni:"L", info:"Tatiana Sundeby"},
  {id:37, name:"Kopy Goldfields AB (publ)", loc:"Stockholm", sni:"B", info:"Arsen Idrisov"},
  {id:38, name:"Krasny Gold Fields AB", loc:"Stockholm", sni:"B", info:"Arsen Idrisov"},
  {id:39, name:"KRAG Solutions AB", loc:"Stockholm", sni:"N", info:"Mikhail Peretyatko"},
  {id:40, name:"Kubikenborg Al. Sundsvall", loc:"Sundsvall", sni:"K", info:"En+/Sual (Deripaska)"},
  {id:41, name:"Kubikenborg Aluminium AB", loc:"Sundsvall", sni:"C", info:"En+/Sual (Deripaska)"},
  {id:42, name:"GANSCA Deponi Aktiebolag", loc:"Sundsvall", sni:"E", info:"En+/Sual (Deripaska)"},
  {id:43, name:"KV GROUP AB", loc:"Långshyttan", sni:"F", info:"Georgijs Kascejevs"},
  {id:44, name:"Malmö Lumber Technology", loc:"Malmö", sni:"G", info:"Evgeny Superfin"},
  {id:45, name:"Meerwind AB", loc:"Helsingborg", sni:"M", info:"Natalia Törnqvist"},
  {id:46, name:"Rörvik Industri och Handel", loc:"Jönköping", sni:"M", info:"Natalia Törnqvist"},
  {id:47, name:"Rörvik Swedfore AB", loc:"Stockaryd", sni:"M", info:"Natalia Törnqvist"},
  {id:48, name:"Rörvik Timber Höglandet", loc:"Jönköping", sni:"L", info:"Natalia Törnqvist"},
  {id:49, name:"NC Nordic Control AB", loc:"Lidingö", sni:"G", info:"Pavel Gerasimov"},
  {id:50, name:"Nimab Anläggning AB", loc:"Sjöbo", sni:"F", info:"Oleg Deripaska"},
  {id:51, name:"NIMAB Entreprenad AB", loc:"Sjöbo", sni:"F", info:"STRABAG (Deripaska)"},
  {id:52, name:"Nimab Support AB", loc:"Sjöbo", sni:"F", info:"STRABAG (Deripaska)"},
  {id:53, name:"Nordic Water Holding AB", loc:"Mölndal", sni:"G", info:"Viktor Vekselberg"},
  {id:54, name:"Nordic Water Products AB", loc:"Mölndal", sni:"G", info:"Viktor Vekselberg"},
  {id:55, name:"PetroGrand AB", loc:"Stockholm", sni:"M", info:"Maxim Korobov"},
  {id:56, name:"Petrosibir AB", loc:"Stockholm", sni:"M", info:"Maxim Korobov"},
  {id:57, name:"Recore Industries AB", loc:"Timrå", sni:"C", info:"Dimitry Zaytsev"},
  {id:58, name:"ARTBOARD Aktiebolag", loc:"Timrå", sni:"C", info:"Recore / Zaytsev"},
  {id:59, name:"Reksoft AB", loc:"Upplands-Väsby", sni:"J", info:"Alexander Egorov"},
  {id:60, name:"RETN Nordic AB", loc:"Solna", sni:"J", info:"Polina Maltseva"},
  {id:61, name:"RISE Capital AB", loc:"Stockholm", sni:"K", info:"Igor Snegurov"},
  {id:62, name:"RISE Estate AB", loc:"Stockholm", sni:"L", info:"Igor Snegurov"},
  {id:63, name:"Safetech Int. Holding", loc:"Stockholm", sni:"K", info:"Petr Zhukov"},
  {id:64, name:"Slami AB", loc:"Mariefred", sni:"I", info:"Viacheslav Mikhaylov"},
  {id:65, name:"Stadsis AB", loc:"Malmö", sni:"K", info:"Vagif Aliev"},
  {id:66, name:"Steelmar Scandinavia AB", loc:"Lidingö", sni:"G", info:"Alexandr Gazalov"},
  {id:67, name:"STRABAG AB", loc:"Örebro", sni:"F", info:"STRABAG (Deripaska)"},
  {id:68, name:"STRABAG Projektutveckling", loc:"Solna", sni:"F", info:"STRABAG (Deripaska)"},
  {id:69, name:"Vasagatan Op6 Holding AB", loc:"Örebro", sni:"F", info:"Oleg Deripaska"},
  {id:70, name:"STRABAG BRVZ AB", loc:"Örebro", sni:"M", info:"Oleg Deripaska"},
  {id:71, name:"STRABAG Rail AB", loc:"Örebro", sni:"F", info:"STRABAG (Deripaska)"},
  {id:72, name:"STRABAG Sverige AB", loc:"Solna", sni:"F", info:"STRABAG (Deripaska)"},
  {id:73, name:"Sulzer Pumps Sweden AB", loc:"Vadstena", sni:"C", info:"Sulzer (Vekselberg)"},
  {id:74, name:"Sweden Bygg Kraft AB", loc:"Hägersten", sni:"F", info:"Iman Sebieva"},
  {id:75, name:"Teknicast Investment Group", loc:"Malmö", sni:"K", info:"Leonid Kiryakov"},
  {id:76, name:"Tele2 Russia Holding AB", loc:"Kista", sni:"K", info:"VTB Bank"},
  {id:77, name:"Tele2 Russian Investments", loc:"Stockholm", sni:"K", info:"VTB Bank"},
  {id:78, name:"The Books Sweden AB", loc:"Enskede", sni:"N", info:"Ekaterina Maliushenkova"},
  {id:79, name:"Thermo Industri i Sthlm", loc:"Stockholm", sni:"G", info:"Vladimir Kilin"},
  {id:80, name:"UMWELTGREEN AB", loc:"Stockholm", sni:"K", info:"Sergey Sokolov"},
  {id:81, name:"Videre Rebus Coatings", loc:"Stockholm", sni:"C", info:"Nina Rodionova"},
  {id:82, name:"WIRUD AB", loc:"Tranås", sni:"G", info:"Elena Sotnikova"},
  {id:83, name:"Woodrow Management AB", loc:"Enskede", sni:"G", info:"Sergey Tataurov"},
  {id:84, name:"Züblin Scandinavia AB", loc:"Solna", sni:"F", info:"Züblin (Deripaska)"},
  {id:85, name:"NCAB Group", loc:"Sundbyberg", sni:"M", info:"Vladimir Makarov"},
  {id:86, name:"Sendify AB", loc:"Göteborg", sni:"H", info:"Alexander Eliseev"},
  {id:87, name:"Tui Sverige AB", loc:"Stockholm", sni:"N", info:"Alexei Mordashov"},
  {id:88, name:"Voi Technologies", loc:"Stockholm", sni:"N", info:"Alexander Eliseev (Min.)"},
  {id:89, name:"Alexey Kuznetsov AB", loc:"Stockholm", sni:"J", info:"Alexey Kuznetsov"},
  {id:90, name:"ALLSERVICE AM AB", loc:"Upplands Väsby", sni:"N", info:"Alan Mamiev"},
  {id:91, name:"ATYX AB", loc:"Stöde", sni:"F", info:"Alexey Molokov"},
  {id:92, name:"Aveda flytt AB", loc:"Handen", sni:"H", info:"Zukhra Dzhalilova"},
  {id:93, name:"Beltrusbygg AB", loc:"Uttran", sni:"F", info:"Nikolay Korzh"},
  {id:94, name:"BMD GROUP AB", loc:"Tyresö", sni:"F", info:"Elena Kopteva"},
  {id:95, name:"Bärbalken 356 AB", loc:"Järfälla", sni:"F", info:"Bashir Motaliev"},
  {id:96, name:"CLEAN CAR PLUS AB", loc:"Älvsjö", sni:"G", info:"Svetlana Mechouki"},
  {id:97, name:"Elvins Bilexpert AB", loc:"Skogås", sni:"F", info:"Elvin Nagizade"},
  {id:98, name:"Fundamental Fastighets.", loc:"Enskede", sni:"F", info:"Elena Podolnaia"},
  {id:99, name:"Galaj Bygg AB", loc:"Södertälje", sni:"F", info:"Lidia Galaeva"},
  {id:100, name:"Grand Arctic Sweden AB", loc:"Älvsjö", sni:"L", info:"Iurii Kuzhelko"},
  {id:101, name:"GreenBjork AB", loc:"Beddingestrand", sni:"G", info:"Sergei Dymov"},
  {id:102, name:"Hellgrens Vent. & Bygg", loc:"Skarpnäck", sni:"F", info:"Sergey Matveev"},
  {id:103, name:"Hjälper SWE AB", loc:"Farsta", sni:"N", info:"Konstantin Kantor"},
  {id:104, name:"Jasmine AB", loc:"Gävle", sni:"P", info:"Dzhennet Abasova"},
  {id:105, name:"Kabardin Media AB", loc:"Stockholm", sni:"J", info:"Tatiana Lytasova"},
  {id:106, name:"KHJ Innovations AB", loc:"Stockholm", sni:"G", info:"Kristina Jakobsson"},
  {id:107, name:"Klinkersson&Kakelson", loc:"Nykvarn", sni:"F", info:"Bogdan Chuvachalov"},
  {id:108, name:"Kristan Bygg AB", loc:"Hjärtum", sni:"C", info:"Kristina Solestrand"},
  {id:109, name:"Kvist Skandinavien AB", loc:"Vårby", sni:"F", info:"Veronika Kvist"},
  {id:110, name:"Limavi AB", loc:"Skogås", sni:"J", info:"Andrey Kolpakov"},
  {id:111, name:"Max Logunov AB", loc:"Kungsängen", sni:"J", info:"Maksim Logunov"},
  {id:112, name:"NextCode AB", loc:"Stockholm", sni:"J", info:"Dmitry Vyalshin"},
  {id:113, name:"NPN Bygg Sthlm AB", loc:"Bagarmossen", sni:"F", info:"Elena Kopteva"},
  {id:114, name:"NPP BYGG AB", loc:"Partille", sni:"F", info:"Aslan Gogitidze"},
  {id:115, name:"PSP Ventilation AB", loc:"Tyresö", sni:"F", info:"Andrei Kudrinskii"},
  {id:116, name:"Questroom AB", loc:"Åkersberga", sni:"R", info:"Grigory Koshmak"},
  {id:117, name:"Resursbostäder Spånga", loc:"Spånga", sni:"L", info:"Dmitrij Simis"},
  {id:118, name:"R-G TRANSPORT AB", loc:"Järfälla", sni:"G", info:"Artush Oganesyan"},
  {id:119, name:"SAA BYGG AB", loc:"Gunnilse", sni:"F", info:"Alexey Sokolov"},
  {id:120, name:"Scandinavian M&T AB", loc:"Uppsala", sni:"M", info:"Konstantin Bryunin"},
  {id:121, name:"SFUP AB", loc:"Uppsala", sni:"L", info:"Konstantin Bryunin"},
  {id:122, name:"SHS Gruppen AB", loc:"Bromma", sni:"F", info:"Igor Boyko"},
  {id:123, name:"Shtark Interiör AB", loc:"Arlandastad", sni:"F", info:"Svetlana Shtark"},
  {id:124, name:"Tasty America AB", loc:"Johanneshov", sni:"G", info:"Irena Elanskaya"},
  {id:125, name:"Team77 Sweden AB", loc:"Segeltorp", sni:"N", info:"Nikolay Korzh"},
  {id:126, name:"The Barkas Collective", loc:"Stockholm", sni:"M", info:"Vitaly Poluzhnikov"},
  {id:127, name:"Toseto Sweden AB", loc:"Bromma", sni:"F", info:"Kirill Kuzhelko"},
  {id:128, name:"VR ENTREPRENAD AB", loc:"Bålsta", sni:"F", info:"Victor Kersikov"}
];

// KOORDINATER FÖR ORTER (För Heatmap)
const cityCoords = {
  "Stockholm": [59.3293, 18.0686],
  "Göteborg": [57.7089, 11.9746],
  "Malmö": [55.6050, 13.0038],
  "Sjöbo": [55.6333, 13.7000],
  "Sundsvall": [62.3908, 17.3069],
  "Örebro": [59.2753, 15.2134],
  "Solna": [59.3689, 18.0083],
  "Lidingö": [59.3633, 18.1333],
  "Timrå": [62.4870, 17.3256],
  "Växjö": [56.8777, 14.8091],
  "Uppsala": [59.8586, 17.6389],
  "Kristinehamn": [59.3094, 14.1086],
  "Jönköping": [57.7826, 14.1618],
  "Helsingborg": [56.0465, 12.6945],
  "Gävle": [60.6749, 17.1413],
  "Borlänge": [60.4843, 15.4340],
  "Långshyttan": [60.5250, 16.0333],
  "Nacka": [59.3110, 18.1650],
  "Hägersten": [59.2833, 17.9833],
  "Bromma": [59.3333, 17.9167],
  "Tyresö": [59.2333, 18.2333],
  "Södertälje": [59.1955, 17.6252],
  "Enskede": [59.2833, 18.0833],
  "Kista": [59.4022, 17.9422],
  "Kungälv": [57.8697, 11.9819],
  "Ljungby": [56.8322, 13.9372],
  "Norrtälje": [59.7580, 18.7050],
  "Linköping": [58.4109, 15.6216],
  "Vadstena": [58.4483, 14.8894],
  "Partille": [57.7400, 12.1000],
  "Bålsta": [59.5667, 17.5333],
  "Åkersberga": [59.4792, 18.2975],
  "Upplands Väsby": [59.5167, 17.9167],
  "Mariefred": [59.2594, 17.2222],
  "Bandhagen": [59.2667, 18.0500],
  "Bagarmossen": [59.2775, 18.1325],
  "Skarpnäck": [59.2667, 18.1333],
  "Vårby": [59.2594, 17.8822],
  "Handen": [59.1667, 18.1333],
  "Stöde": [62.4167, 16.8667],
  "Skogås": [59.2167, 18.1667],
  "Segeltorp": [59.2833, 17.9333],
  "Järfälla": [59.4167, 17.8333],
  "Spånga": [59.3833, 17.8833],
  "Farsta": [59.2433, 18.0936],
  "Johanneshov": [59.2936, 18.0825],
  "Arlandastad": [59.6167, 17.9167],
  "Nykvarn": [59.1783, 17.4322],
  "Kungsängen": [59.4833, 17.7500],
  "Upplands-Väsby": [59.5167, 17.9167],
  "Stockaryd": [57.3167, 14.5833],
  "Gunnilse": [57.8000, 12.0833],
  "Beddingestrand": [55.3667, 13.4333],
  "Uttran": [59.1833, 17.7833],
  "Hjärtum": [58.1833, 12.1167],
  "Norsborg": [59.2444, 17.8136],
  "Sundbyberg": [59.3611, 17.9722]
};

// ==========================================
// 3. LOGIK (JS)
// ==========================================

// --- RÖDA RINGAR: KÖPTA/STRATEGISKA FASTIGHETER ---
const strategicProperties = [
    { name: "Handelsrepresentationen (DK)", coords: [55.7276, 12.5638], info: "Vestagervej 7, Hellerup. Känd spioncentral (PET)." },
    { name: "Ruslands Hus (DK)", coords: [55.6783, 12.5681], info: "Vester Voldgade 11. Ryskt kulturhus/Propagandacentral." },
    { name: "Alexander Nevsky Kirke (DK)", coords: [55.6853, 12.5913], info: "Bredgade 53. Rysk-ortodox samlingspunkt." },
    { name: "Muskö (Aleshchenko)", coords: [59.0800, 18.1300], info: "Sjötomt vid marinbasen. 220 Mkr skattetvist." },
    { name: "Ryska huset (Lidingö)", coords: [59.3562, 18.1408], info: "Kostervägen 5. Utpekad bas för GRU/SVR. Strategiskt läge mellan flygplatser." },
    { name: "Furusund (Nätverk)", coords: [59.66056, 18.90694], info: "Ryskt nätverk köper tomter i strategiskt inlopp." },
    { name: "Vettershaga (Nätverk)", coords: [59.60722, 18.68056], info: "Vid Bergshamravikens inlopp. Underrättelsekopplingar." },
    { name: "Kvicksundsbron (Tomt)", coords: [59.4533, 16.3197], info: "Tomt nära strategisk bro. Kopplat till Västerås-nätverk (Liberalerna)." },
    { name: "Vidja (Huddinge)", coords: [59.215, 18.110], info: "Fastighet nära Swedish Space Corp (Ågesta). Använd som adressbank." },
    { name: "Västerås (Hässlö)", coords: [59.589, 16.635], info: "Ryska Kyrkan. Ligger strategiskt nära Västerås Flygplats." },
    { name: "S:t Sigfrids Kyrka (Aspudden)", coords: [59.3061, 18.0005], info: "Kuppartat övertagandeförsök av rysk församling (Kyrkans Tidning 2025)." },
    { name: "Airiston Helmi (Finland)", coords: [60.233, 22.133], info: "Pargas (Åbolands skärgård). Tillslag 2018 mot misstänkt penningtvätt/underrättelse." },
    { name: "Åland (Beslag)", coords: [60.100, 19.900], info: "Finska staten beslagtar ryska fastigheter (Naftogaz-målet 2025)." },
    { name: "Svalbard (Pyramiden)", coords: [78.656, 16.325], info: "Rysk närvaro förstärks (Pyramiden/Barentsburg) för att utmana norsk suveränitet." },
    { name: "Kirkenes (Gränsen)", coords: [69.727, 30.045], info: "Hybridhot och strategisk spänning vid gränsen. Porten till öst." },
    { name: "Bardufoss (Norge)", coords: [69.056, 18.530], info: "'Russerhyttene'. Stugor med utsikt över militär flygbas." }
];

// --- X-MARKERINGAR: BLOCKERADE KÖP/OMRÅDEN ---
const blockedProperties = [
    { name: "Finland: Sysmä", coords: [61.503, 25.684], info: "Försvarsministeriet blockerade fastighetsköp av säkerhetsskäl (Yle)." },
    { name: "Finland: Ruokolahti", coords: [61.283, 28.816], info: "Stoppad affär nära kritisk infrastruktur (Yle)." },
    { name: "Finland: Kankaanpää", coords: [61.800, 22.400], info: "Nära Niinisalo garnison. Köp stoppat." },
    { name: "Estland: Narva (Ida-Viru)", coords: [59.379, 28.199], info: "Gränszon där tredjelandsmedborgare ej får köpa mark." },
    { name: "Estland: Võru", coords: [57.844, 27.011], info: "Säkerhetszon mot ryska gränsen. Fastighetsköp begränsade." }
];

// --- VY-HANTERING ---
function setView(viewName) {
    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.view-btn').forEach(el => el.classList.remove('active'));
    
    document.getElementById('view-' + viewName).classList.add('active');
    document.querySelector(`button[onclick="setView('${viewName}')"]`).classList.add('active');

    if (viewName === 'map') {
        initMap(); // Rita kartan när den visas
    }
}

// --- RITA TRÄDET (HORISONTELLT) ---
const treeRoot = document.getElementById('tree-root');

function renderTree(node, container) {
  const nodeEl = document.createElement('div');
  nodeEl.className = 'node';
  if(node.isRoot) nodeEl.classList.add('root');

  // Skapa Content-boxen
  const contentEl = document.createElement('div');
  contentEl.className = 'content';
  if(node.highlight) contentEl.classList.add('highlight-box');
  if(node.alert) contentEl.classList.add('alert-box');

  // Titel-raden
  const titleEl = document.createElement('div');
  titleEl.className = 'title';
  
  // Titeltext
  const textSpan = document.createElement('span');
  textSpan.innerText = node.title;
  titleEl.appendChild(textSpan);

  // Toggle +/- knapp (Ligger till höger nu)
  const hasChildren = node.children && node.children.length > 0;
  if(hasChildren) {
    const btn = document.createElement('span');
    btn.className = 'toggle-icon';
    btn.innerText = '-'; // Standard: utfälld
    titleEl.appendChild(btn);
    
    // Klick-event för att fälla in/ut
    contentEl.onclick = function(e) {
      if(e.target.classList.contains('link')) return; // Klicka ej på länkar
      const childCont = nodeEl.querySelector('.children');
      if(childCont) {
        childCont.classList.toggle('hidden');
        btn.innerText = childCont.classList.contains('hidden') ? '+' : '-';
      }
    };
  } else {
    nodeEl.classList.add('leaf');
  }

  contentEl.appendChild(titleEl);

  // Info-text
  if(node.info) {
    const infoEl = document.createElement('div');
    infoEl.className = 'info';
    infoEl.innerText = node.info;
    contentEl.appendChild(infoEl);
  }

  // Länkar (Knappar)
  if(node.links && node.links.length > 0) {
    const linksDiv = document.createElement('div');
    linksDiv.className = 'links';
    node.links.forEach(link => {
        const a = document.createElement('a');
        a.href = link.url;
        a.target = "_blank";
        a.className = 'link';
        a.innerText = link.text + " ↗";
        linksDiv.appendChild(a);
    });
    contentEl.appendChild(linksDiv);
  } else if (node.link) { 
    const linksDiv = document.createElement('div');
    linksDiv.className = 'links';
    const a = document.createElement('a');
    a.href = node.link;
    a.target = "_blank";
    a.className = 'link';
    a.innerText = "LÄNK ↗";
    linksDiv.appendChild(a);
    contentEl.appendChild(linksDiv);
  }

  nodeEl.appendChild(contentEl);

  // Rendera barn rekursivt
  if(hasChildren) {
    const childContainer = document.createElement('div');
    childContainer.className = 'children';
    node.children.forEach(child => renderTree(child, childContainer));
    nodeEl.appendChild(childContainer);
  }

  container.appendChild(nodeEl);
}

// Globala funktioner för knapparna
function expandAll() {
    document.querySelectorAll('.children').forEach(el => {
        el.classList.remove('hidden');
        const btn = el.parentElement.querySelector('.toggle-icon');
        if(btn) btn.innerText = '-';
    });
}

function collapseAll() {
    document.querySelectorAll('.children').forEach(el => {
        el.classList.add('hidden');
        const btn = el.parentElement.querySelector('.toggle-icon');
        if(btn) btn.innerText = '+';
    });
    // Håll roten öppen
    const root = document.querySelector('.children'); 
    if(root) {
        root.classList.remove('hidden');
        const btn = root.parentElement.querySelector('.toggle-icon');
        if(btn) btn.innerText = '-';
    }
}

// --- RITA FOI TABELLEN ---
const foiBody = document.getElementById('foi-body');
const foiCount = document.getElementById('foi-count');

function renderFOI(data) {
  foiBody.innerHTML = "";
  data.forEach(item => {
    let sniClass = "sni-def";
    if(item.sni === "F") sniClass = "sni-F";
    else if(item.sni === "G") sniClass = "sni-G";
    else if(item.sni === "K") sniClass = "sni-K";
    else if(item.sni === "M") sniClass = "sni-M";

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.id}</td>
      <td>
        <div style="font-weight:bold;">${item.name}</div>
        <div style="color:#666;">${item.loc}</div>
      </td>
      <td style="text-align:center;"><span class="sni-tag ${sniClass}">${item.sni}</span></td>
      <td>${item.info}</td>
    `;
    foiBody.appendChild(tr);
  });
  foiCount.innerText = "Visar " + data.length + " av " + foiList.length + " bolag";
}

function filterFOI() {
  const q = document.getElementById('searchFOI').value.toLowerCase();
  const filtered = foiList.filter(item => 
    item.name.toLowerCase().includes(q) || 
    item.info.toLowerCase().includes(q) ||
    item.loc.toLowerCase().includes(q)
  );
  renderFOI(filtered);
}

// --- KARTA (HEATMAP/CLUSTERS) ---
let map;
function initMap() {
    if(map) {
        setTimeout(() => map.invalidateSize(), 100);
        return; 
    }

    // Centrera på södra Sverige
    map = L.map('map-container').setView([59.0, 16.0], 5);

    // Gratis kartlager (OpenStreetMap)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        subdomains: 'abcd',
        maxZoom: 19
    }).addTo(map);

    // 1. LÄGG TILL BOLAG (FOI) - Små färgade prickar
    let hits = 0;
    foiList.forEach(company => {
        let coords = cityCoords[company.loc];
        if(!coords) {
            if(company.loc.includes("Stockholm")) coords = cityCoords["Stockholm"];
        }

        if (coords) {
            // Jitter för spridning
            const lat = coords[0] + (Math.random() - 0.5) * 0.02;
            const lng = coords[1] + (Math.random() - 0.5) * 0.02;

            let color = "#95a5a6";
            if(company.sni === "F") color = "#e67e22"; 
            if(company.sni === "K") color = "#8e44ad"; 
            if(company.sni === "G") color = "#27ae60"; 
            if(company.sni === "M") color = "#2980b9"; 

            const circle = L.circleMarker([lat, lng], {
                radius: 6,
                fillColor: color,
                color: "#fff",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.7
            }).addTo(map);

            circle.bindPopup(`<b>${company.name} (FOI)</b><br>${company.loc}<br>${company.info}`);
            hits++;
        }
    });

    // 2. LÄGG TILL KÖPTA FASTIGHETER (Röda ringar)
    strategicProperties.forEach(prop => {
        const ring = L.circleMarker(prop.coords, {
            radius: 10,
            fillColor: 'transparent', // Genomskinlig mitten
            color: '#c0392b',        // Röd kant
            weight: 3,               // Tjockare kant
            opacity: 1
        }).addTo(map);
        
        ring.bindPopup(`<b>FASTIGHET: ${prop.name}</b><br>${prop.info}`);
    });

    // 3. LÄGG TILL BLOCKERADE KÖP (X-Markeringar)
    blockedProperties.forEach(prop => {
        const xIcon = L.divIcon({
            className: 'custom-x-icon',
            html: '<span class="x-marker-symbol">X</span>',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        const marker = L.marker(prop.coords, { icon: xIcon }).addTo(map);
        marker.bindPopup(`<b>BLOCKERAT KÖP/OMRÅDE: ${prop.name}</b><br>${prop.info}`);
    });
}

// --- LEGEND TOGGLE ---
function toggleLegend() {
    const content = document.getElementById('legend-content');
    const icon = document.getElementById('legend-icon');
    
    if (content.style.display === "none") {
        content.style.display = "block";
        icon.innerText = "−"; // Minus
    } else {
        content.style.display = "none";
        icon.innerText = "+"; // Plus
    }
}

// Starta allt
renderTree(treeData, treeRoot);
renderFOI(foiList);

</script>
</body>
</html>
